<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hack The Box - Paper | Hakune Blog</title><meta name=keywords content><meta name=description content="Utilize multiple CVEs and a vulnerable bot to get root on a company's server"><meta name=author content="Aki Hakune"><link rel=canonical href=https://git-akihakune.github.io><link crossorigin=anonymous href=/assets/css/stylesheet.min.7b26273a6cb7653c969d53cc1f81a6c09d5376b604e64917377ca7fbc3196e36.css integrity="sha256-eyYnOmy3ZTyWnVPMH4GmwJ1TdrYE5kkXN3yn+8MZbjY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://git-akihakune.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://git-akihakune.github.io/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://git-akihakune.github.io/favicon.ico><link rel=apple-touch-icon href=https://git-akihakune.github.io/favicon.ico><link rel=mask-icon href=https://git-akihakune.github.io/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://git-akihakune.github.io/blog/paper/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=manifest href=/hakune.webmanifest><link rel=stylesheet type=text/css href=/hugo-cite.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-F8M24PKNWZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F8M24PKNWZ",{anonymize_ip:!1})}</script><meta property="og:title" content="Hack The Box - Paper"><meta property="og:description" content="Utilize multiple CVEs and a vulnerable bot to get root on a company's server"><meta property="og:type" content="article"><meta property="og:url" content="https://git-akihakune.github.io/blog/paper/"><meta property="og:image" content="https://git-akihakune.github.io/img/paper/paper.webp"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-06-21T10:38:56+07:00"><meta property="article:modified_time" content="2022-06-21T10:38:56+07:00"><meta property="og:site_name" content="Hakune Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://git-akihakune.github.io/img/paper/paper.webp"><meta name=twitter:title content="Hack The Box - Paper"><meta name=twitter:description content="Utilize multiple CVEs and a vulnerable bot to get root on a company's server"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blogs","item":"https://git-akihakune.github.io/blog/"},{"@type":"ListItem","position":3,"name":"Hack The Box - Paper","item":"https://git-akihakune.github.io/blog/paper/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hack The Box - Paper","name":"Hack The Box - Paper","description":"Utilize multiple CVEs and a vulnerable bot to get root on a company's server","keywords":[],"articleBody":"Overview Welcome to Paper machine from Hack The Box!\nSpoilers:  In this machine, we will conduct some reconnaissance on a default CentOS HTTP test page, to reveal a hidden Wordpress blog behind a subdomain. A vulnerability in that Wordpress version allowed us to see the site's draft posts, led us to a hidden Rocketchat app. After having registered and entered the Rocketchat session, we found a bot which ultimately gave us a glimpse on the credentials in the machine's environment variables. Using that credentials, we got into SSH, eventually found a Polkit vulnerability and escaleted to root.\nI. Initial Reconnaissance 1. Port scan tl;dr: Nothing out of ordinary  As per usual, we start with a port scan:\n# Nmap 7.92 scan initiated Wed Jun 15 04:58:52 2022 as: nmap -p- -sC -sV -oN nmap.txt 10.10.11.143 Nmap scan report for 10.10.11.143 Host is up (0.16s latency). Not shown: 997 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.0 (protocol 2.0) | ssh-hostkey: | 2048 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 (RSA) | 256 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 (ECDSA) |_ 256 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 (ED25519) 80/tcp open http Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9) |_http-title: HTTP Server Test Page powered by CentOS |_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9 443/tcp open ssl/http Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9) |_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28 | http-methods: |_ Potentially risky methods: TRACE |_http-title: HTTP Server Test Page powered by CentOS | ssl-cert: Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US | Subject Alternative Name: DNS:localhost.localdomain | Not valid before: 2021-07-03T08:52:34 |_Not valid after: 2022-07-08T10:32:34 | tls-alpn: |_ http/1.1 |_ssl-date: TLS randomness does not represent time |_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9  Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Wed Jun 15 04:59:20 2022 -- 1 IP address (1 host up) scanned in 27.89 seconds Nothing seemed out of place. There’s a web service on port 80, and port 443 was just its HTTPS version, nothing different. Port 22 was running the most up-to-date version of OpenSSH. Overall, seems like our only attack vector lied in that web application.\n2. Examining the web page tl;dr: Found out a subdomain  Upon opening it in a web browser, we’re greeted with something like this:  Default CentOS HTTP test page  A completely unmodified, invulnerable, CentOS HTTP test page, which rose a question of whether its source code was hiding anything abnormal. In an attempt to find any unusualness, I came across an unexpected clue.\n This was a request intercepted by Burp Suite. Taking a closer look, we found the X-Backend-Server header in that response contained something quite novel: definitely a new attack vector. Weirdly enough, there should had been a hint to this subdomain somewhere in Nmap’s scan result, but in reality it was nowhere to be found - why?\nAnyway, first off, this subdomain need to be added to our /etc/hosts file. The file should now look somewhat like this:\n127.0.0.1\tlocalhost 127.0.1.1\tkali 10.10.11.143\toffice.paper  # The following lines are desirable for IPv6 capable hosts ::1 localhost ip6-localhost ip6-loopback ff02::1 ip6-allnodes ff02::2 ip6-allrouters 3. Checking the subdomain page tl;dr: A vulnerable version of Wordpress led to another subdomain  Opening it in a web browser, we found a typical Wordpress site:  office.paper in a web browser  This speculation was confirmed by this line at the very bottom:  Made by Wordpress confirmation in footer  This subdomain seemed to housed a Wordpress blog site. We can see a fictional tragic character development here: That’s a bonus point for this machine’s realism. Looking around the posts, we found a rather valuable comment: As a secret that may be useful was hidden in draft posts, our only reasonable next step was to attack this web page.\nA quick wpscan revealed a neat vulnerability.\n[+] WordPress version 5.2.3 identified (Insecure, released on 2019-09-05).  | Found By: Rss Generator (Passive Detection)  | - http://office.paper/index.php/feed/, https://wordpress.org/?v=5.2.3  | - http://office.paper/index.php/comments/feed/, https://wordpress.org/?v=5.2.3 This unupdated version of Wordpress contained a vulnerability that would be of use, whose details can be found here: https://vulners.com/zdt/1337DAY-ID-33546.\nIn short, it offered exactly what we needed - unauthenticated view of draft posts. Adding ?static=1 after the URL and that was all it took to get all hidden posts.  Unauthenticated posts view  Another hidden subdomain came into sight. Accordingly, we modified our /etc/hosts.\n10.10.11.143\toffice.paper chat.office.paper II. User Flag 1. Discovering Rocket Chat instance Going to http://chat.office.paper, we found a login page.  rocket.chat login form  For those who don’t know, basically Rocket Chat resembles Discord to a certain degree, except that it’s open source and can be self-hosted.\nHead over to the register form we got earlier, simply register an account (made up credentials were accepted) and log in.  Rocket Chat register form  For those who have used Discord or IRC, you can find this interface a bit familiar.  Rocket Chat blank interface  2. Toying with the bot tl;dr: Chat bot  Lurking around the chat without any permission (which always brings a sense of illegal, even when it was just a ctf challenge), we found nothing noticeable but this bot: The help message pretty much summarized all the functionalities this bot served. To our security eyes, only the third one matter: that file read command. We can reasonably deduce that it simply print out anything that was fed in the cat command. I tried to inject other OS commands in, but it didn’t work.\nTo this point, we’d had file read permission. Which file can we read to go further into this machine?\nNone other than files in the /proc directory, and in this particular case, environment variables seemed to be the answer.\n That command yielded quite a surprise - some credentials were hidden inside environment variables: Wondering what purpose they are used for, I tried them against the Rocket Chat login form.  Rocket Chat didn’t accept those credentials  But the credentials were deemed incorrect. Where else can they be used? Maybe, on the SSH? To no one surprise, those credentials got me a stable SSH connection. You can find the user flag right off the bat in that user’s home directory. III. Root Flag Lazy as I am, I let Linpeas do all the heavy lifting and sweetly riped this fruit: It was trivial to find exploits for this infamous CVE on Github. In my particular case, since the machine already had Python 3.6, I went with this exploit script:  \nMerely running the script would give you full root-level control: There should have been a video here but your browser does not seem to support it. \nIV. Conclusion And that’s about it - all involved around outdated softwares and a vulnerable bot. Hope you have enjoyed this machine and learned things along the way!\n","wordCount":"1125","inLanguage":"en","image":"https://git-akihakune.github.io/img/paper/paper.webp","datePublished":"2022-06-21T10:38:56+07:00","dateModified":"2022-06-21T10:38:56+07:00","author":[{"@type":"Person","name":"Aki Hakune"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://git-akihakune.github.io/blog/paper/"},"publisher":{"@type":"Organization","name":"Hakune Blog","logo":{"@type":"ImageObject","url":"https://git-akihakune.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://git-akihakune.github.io accesskey=h title="Blog (Alt + H)"><img src=https://git-akihakune.github.io/static/banner.png alt=logo aria-label=logo height=40>Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://git-akihakune.github.io/vi/ title=Vi aria-label=Vi>Vi</a></li></ul></span></div><ul id=menu><li><a href=https://akihakune.vercel.app title=profile><span>profile</span></a></li><li><a href=https://git-akihakune.github.io/archive/ title=timeline><span>timeline</span></a></li><li><a href=https://git-akihakune.github.io/blog/ title=blog><span>blog</span></a></li><li><a href=https://git-akihakune.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://git-akihakune.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://git-akihakune.github.io>Home</a>&nbsp;»&nbsp;<a href=https://git-akihakune.github.io/blog/>Blogs</a></div><h1 class=post-title>Hack The Box - Paper</h1><div class=post-description>Utilize multiple CVEs and a vulnerable bot to get root on a company's server</div><div class=post-meta><span title="2022-06-21 10:38:56 +0700 +07">June 21, 2022</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Aki Hakune&nbsp;|&nbsp;<a href=https://github.com/git-akihakune/git-akihakune.github.io/tree/main/blog/paper.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=lazy src=https://git-akihakune.github.io/img/paper/paper.webp alt="Hack The Box Paper Machine"><p>Hack The Box - Paper</p></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#overview aria-label=Overview>Overview</a></li><li><a href=#i-initial-reconnaissance aria-label="I. Initial Reconnaissance">I. Initial Reconnaissance</a><ul><li><a href=#1-port-scan aria-label="1. Port scan">1. Port scan</a></li><li><a href=#2-examining-the-web-page aria-label="2. Examining the web page">2. Examining the web page</a></li><li><a href=#3-checking-the-subdomain-page aria-label="3. Checking the subdomain page">3. Checking the subdomain page</a></li></ul></li><li><a href=#ii-user-flag aria-label="II. User Flag">II. User Flag</a><ul><li><a href=#1-discovering-rocket-chat-instance aria-label="1. Discovering Rocket Chat instance">1. Discovering Rocket Chat instance</a></li><li><a href=#2-toying-with-the-bot aria-label="2. Toying with the bot">2. Toying with the bot</a></li></ul></li><li><a href=#iii-root-flag aria-label="III. Root Flag">III. Root Flag</a></li><li><a href=#iv-conclusion aria-label="IV. Conclusion">IV. Conclusion</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const e=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${e}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>Welcome to <strong>Paper</strong> machine from
<span style=color:#9fef00><strong>Hack The Box</strong></span>!</p><p><em><strong>Spoilers</strong></em>: <em><span style=font-size:90%>In this machine, we will conduct some reconnaissance on a default CentOS HTTP test page, to reveal a hidden Wordpress blog behind a subdomain. A vulnerability in that Wordpress version allowed us to see the site's draft posts, led us to a hidden Rocketchat app. After having registered and entered the Rocketchat session, we found a bot which ultimately gave us a glimpse on the credentials in the machine's environment variables. Using that credentials, we got into SSH, eventually found a Polkit vulnerability and escaleted to root.</span></em></p><h2 id=i-initial-reconnaissance>I. Initial Reconnaissance<a hidden class=anchor aria-hidden=true href=#i-initial-reconnaissance>#</a></h2><h3 id=1-port-scan>1. Port scan<a hidden class=anchor aria-hidden=true href=#1-port-scan>#</a></h3><p><span style=color:#696969>tl;dr: Nothing out of ordinary</span><br>As per usual, we start with a port scan:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Nmap 7.92 scan initiated Wed Jun 15 04:58:52 2022 as: nmap -p- -sC -sV -oN nmap.txt 10.10.11.143</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.143
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.16s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>997</span> closed tcp ports <span style=color:#f92672>(</span>reset<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE  VERSION
</span></span><span style=display:flex><span>22/tcp  open  ssh      OpenSSH 8.0 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp  open  http     Apache httpd 2.4.37 <span style=color:#f92672>((</span>centos<span style=color:#f92672>)</span> OpenSSL/1.1.1k mod_fcgid/2.3.9<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: HTTP Server Test Page powered by CentOS
</span></span><span style=display:flex><span>|_http-generator: HTML Tidy <span style=color:#66d9ef>for</span> HTML5 <span style=color:#66d9ef>for</span> Linux version 5.7.28
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.37 <span style=color:#f92672>(</span>centos<span style=color:#f92672>)</span> OpenSSL/1.1.1k mod_fcgid/2.3.9
</span></span><span style=display:flex><span>443/tcp open  ssl/http Apache httpd 2.4.37 <span style=color:#f92672>((</span>centos<span style=color:#f92672>)</span> OpenSSL/1.1.1k mod_fcgid/2.3.9<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-generator: HTML Tidy <span style=color:#66d9ef>for</span> HTML5 <span style=color:#66d9ef>for</span> Linux version 5.7.28
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-title: HTTP Server Test Page powered by CentOS
</span></span><span style=display:flex><span>| ssl-cert: Subject: commonName<span style=color:#f92672>=</span>localhost.localdomain/organizationName<span style=color:#f92672>=</span>Unspecified/countryName<span style=color:#f92672>=</span>US
</span></span><span style=display:flex><span>| Subject Alternative Name: DNS:localhost.localdomain
</span></span><span style=display:flex><span>| Not valid before: 2021-07-03T08:52:34
</span></span><span style=display:flex><span>|_Not valid after:  2022-07-08T10:32:34
</span></span><span style=display:flex><span>| tls-alpn: 
</span></span><span style=display:flex><span>|_  http/1.1
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent time
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.37 <span style=color:#f92672>(</span>centos<span style=color:#f92672>)</span> OpenSSL/1.1.1k mod_fcgid/2.3.9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span><span style=color:#75715e># Nmap done at Wed Jun 15 04:59:20 2022 -- 1 IP address (1 host up) scanned in 27.89 seconds</span>
</span></span></code></pre></div><p>Nothing seemed out of place. There&rsquo;s a web service on port 80, and port 443 was just its HTTPS version, nothing different. Port 22 was running the most up-to-date version of <strong>OpenSSH</strong>. Overall, seems like our only attack vector lied in that web application.</p><h3 id=2-examining-the-web-page>2. Examining the web page<a hidden class=anchor aria-hidden=true href=#2-examining-the-web-page>#</a></h3><p><span style=color:#696969>tl;dr: Found out a subdomain</span><br>Upon opening it in a web browser, we&rsquo;re greeted with something like this:<figure><img src=/img/paper/port-80.webp#center alt="default centos http test page"><figcaption>Default CentOS HTTP test page</figcaption></figure></p><p>A completely unmodified, invulnerable, CentOS HTTP test page, which rose a question of whether its source code was hiding anything abnormal. In an attempt to find any unusualness, I came across an unexpected clue.</p><p><img src=/img/paper/initial_request.webp#center alt="a burp suite request to root web path"></p><p>This was a request intercepted by Burp Suite. Taking a closer look, we found the <code>X-Backend-Server</code> header in that response contained something quite novel: definitely a new attack vector. Weirdly enough, there should had been a hint to this subdomain somewhere in Nmap&rsquo;s scan result, but in reality it was nowhere to be found - why?</p><p>Anyway, first off, this subdomain need to be added to our <code>/etc/hosts</code> file. The file should now look somewhat like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>127.0.0.1	localhost
</span></span><span style=display:flex><span>127.0.1.1	kali
</span></span><span style=display:flex><span>10.10.11.143	office.paper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The following lines are desirable for IPv6 capable hosts</span>
</span></span><span style=display:flex><span>::1     localhost ip6-localhost ip6-loopback
</span></span><span style=display:flex><span>ff02::1 ip6-allnodes
</span></span><span style=display:flex><span>ff02::2 ip6-allrouters
</span></span></code></pre></div><h3 id=3-checking-the-subdomain-page>3. Checking the subdomain page<a hidden class=anchor aria-hidden=true href=#3-checking-the-subdomain-page>#</a></h3><p><span style=color:#696969>tl;dr: A vulnerable version of <strong>Wordpress</strong> led to another subdomain</span><br>Opening it in a web browser, we found a typical Wordpress site:<figure><img src=/img/paper/office_paper_page.webp#center alt="office.paper as opened in web browser"><figcaption><code>office.paper</code> in a web browser</figcaption></figure></p><p>This speculation was confirmed by this line at the very bottom:<figure><img src=/img/paper/made_by_wordpress.webp#center alt="Powered by Wordpress footer"><figcaption>Made by Wordpress confirmation in footer</figcaption></figure></p><p>This subdomain seemed to housed a Wordpress blog site. We can see a fictional tragic character development here:
<img src=/img/paper/tragic_character_developments.webp#center alt="a sad character development in blog posts"></p><p>That&rsquo;s a bonus point for this machine&rsquo;s realism. Looking around the posts, we found a rather valuable comment:
<img src=/img/paper/blog_comment.webp#center alt="a comment mentioned about secret content in draft posts"></p><p>As a secret that may be useful was hidden in draft posts, our only reasonable next step was to attack this web page.</p><p>A quick <strong>wpscan</strong> revealed a neat vulnerability.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> WordPress version 5.2.3 identified <span style=color:#f92672>(</span>Insecure, released on 2019-09-05<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span> | Found By: Rss Generator <span style=color:#f92672>(</span>Passive Detection<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span> |  - http://office.paper/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v<span style=color:#f92672>=</span>5.2.3&lt;/generator&gt;
</span></span><span style=display:flex><span> |  - http://office.paper/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v<span style=color:#f92672>=</span>5.2.3&lt;/generator&gt;
</span></span></code></pre></div><p>This unupdated version of Wordpress contained a vulnerability that would be of use, whose details can be found here: <a href=https://vulners.com/zdt/1337DAY-ID-33546>https://vulners.com/zdt/1337DAY-ID-33546</a>.</p><p>In short, it offered exactly what we needed - unauthenticated view of draft posts. Adding <code>?static=1</code> after the URL and that was all it took to get all hidden posts.<figure><img src=/img/paper/wp-draft-vuln.webp#center alt="Unauthenticated posts view"><figcaption>Unauthenticated posts view</figcaption></figure></p><p>Another hidden subdomain came into sight. Accordingly, we modified our <code>/etc/hosts</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>10.10.11.143	office.paper chat.office.paper
</span></span></code></pre></div><h2 id=ii-user-flag>II. User Flag<a hidden class=anchor aria-hidden=true href=#ii-user-flag>#</a></h2><h3 id=1-discovering-rocket-chat-instance>1. Discovering Rocket Chat instance<a hidden class=anchor aria-hidden=true href=#1-discovering-rocket-chat-instance>#</a></h3><p>Going to <code>http://chat.office.paper</code>, we found a login page.<figure><img src=/img/paper/rocket_chat.webp#center alt="Rocket Chat login form"><figcaption>rocket.chat login form</figcaption></figure></p><p>For those who don&rsquo;t know, basically <strong>Rocket Chat</strong> resembles <a href=https://discord.com/>Discord</a> to a certain degree, except that it&rsquo;s open source and can be self-hosted.</p><p>Head over to the register form we got earlier, simply register an account (made up credentials were accepted) and log in.<figure><img src=/img/paper/register_form.webp#center alt="Rocket Chat register form"><figcaption>Rocket Chat register form</figcaption></figure></p><p>For those who have used Discord or IRC, you can find this interface a bit familiar.<figure><img src=/img/paper/rocketchat_interface.webp#center alt="Rocket Chat blank interface"><figcaption>Rocket Chat blank interface</figcaption></figure></p><h3 id=2-toying-with-the-bot>2. Toying with the bot<a hidden class=anchor aria-hidden=true href=#2-toying-with-the-bot>#</a></h3><p><span style=color:#696969>tl;dr: Chat bot</span><br>Lurking around the chat without any permission <em>(which always brings a sense of illegal, even when it was just a ctf challenge)</em>, we found nothing noticeable but this bot:
<img src=/img/paper/bot_help.webp#center alt="Rocket Chat bot"></p><p>The help message pretty much summarized all the functionalities this bot served. To our security eyes, only the third one matter: that file read command.
<img src=/img/paper/bot_cat_feature.webp#center alt="Test file read function on Rocket Chat bot"></p><p>We can reasonably deduce that it simply print out anything that was fed in the <code>cat</code> command. I tried to inject other OS commands in, but it didn&rsquo;t work.</p><p>To this point, we&rsquo;d had file read permission. Which file can we read to go further into this machine?</p><p>None other than files in the <code>/proc</code> directory, and in this particular case, environment variables seemed to be the answer.</p><p><img src=/img/paper/bot_check_env_variables.webp#center alt="Read environment variables in /proc/self/environ from Rocket Chat bot"></p><p>That command yielded quite a surprise - some credentials were hidden inside environment variables:
<img src=/img/paper/bot_env_variable_response.webp#center alt="Environment variables printed by Rocket Chat bot"></p><p>Wondering what purpose they are used for, I tried them against the Rocket Chat login form.<figure><img src=/img/paper/rocketchat_wrong_password.webp#center alt="Rocket Chat login failed with newly gained credentials"><figcaption>Rocket Chat didn&rsquo;t accept those credentials</figcaption></figure></p><p>But the credentials were deemed incorrect. Where else can they be used? Maybe, on the SSH?
<img src=/img/paper/ssh_login.webp#center alt="Successful SSH login attempt"></p><p>To no one surprise, those credentials got me a stable SSH connection. You can find the user flag right off the bat in that user&rsquo;s home directory.
<img src=/img/paper/user_flag.webp#center alt="User flag in home directory"></p><h2 id=iii-root-flag>III. Root Flag<a hidden class=anchor aria-hidden=true href=#iii-root-flag>#</a></h2><p>Lazy as I am, I let Linpeas do all the heavy lifting and sweetly riped this fruit:
<img src=/img/paper/linpeas_result.webp#center alt="Linpeas running result"></p><p>It was trivial to find exploits for this infamous CVE on Github. In my particular case, since the machine already had <code>Python 3.6</code>, I went with this exploit script:<div style=text-align:center><div class=github-card data-github=Almorabea/Polkit-exploit data-width=400 data-height=150 data-theme=default></div><script src=//cdn.jsdelivr.net/github-cards/latest/widget.js></script></div></p><p>Merely running the script would give you full root-level control:
<video class=video-shortcode preload=auto controls>
<source src=/img/paper/privesc.mp4 type=video/mp4>There should have been a video here but your browser does not seem
to support it.</video></p><h2 id=iv-conclusion>IV. Conclusion<a hidden class=anchor aria-hidden=true href=#iv-conclusion>#</a></h2><p>And that&rsquo;s about it - all involved around outdated softwares and a vulnerable bot. Hope you have enjoyed this machine and learned things along the way!</p></div><footer class=post-footer><nav class=paginav><a class=next href=https://git-akihakune.github.io/blog/start-with-android-pentest/><span class=title>Next Page »</span><br><span>An Introduction to Android Pentesting</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Paper on twitter" href="https://twitter.com/intent/tweet/?text=Hack%20The%20Box%20-%20Paper&url=https%3a%2f%2fgit-akihakune.github.io%2fblog%2fpaper%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Paper on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fgit-akihakune.github.io%2fblog%2fpaper%2f&title=Hack%20The%20Box%20-%20Paper&summary=Hack%20The%20Box%20-%20Paper&source=https%3a%2f%2fgit-akihakune.github.io%2fblog%2fpaper%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Paper on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fgit-akihakune.github.io%2fblog%2fpaper%2f&title=Hack%20The%20Box%20-%20Paper"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Paper on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgit-akihakune.github.io%2fblog%2fpaper%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Paper on whatsapp" href="https://api.whatsapp.com/send?text=Hack%20The%20Box%20-%20Paper%20-%20https%3a%2f%2fgit-akihakune.github.io%2fblog%2fpaper%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hack The Box - Paper on telegram" href="https://telegram.me/share/url?text=Hack%20The%20Box%20-%20Paper&url=https%3a%2f%2fgit-akihakune.github.io%2fblog%2fpaper%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://git-akihakune.github.io>Hakune Blog</a></span>
- Aki Hakune</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.8)"})})</script><script type=module src=https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js></script>
<script nomodule src=https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>